<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, ,maximum-scale=1.0,user-scalable=no" />
<script src="http://amiechenn.github.io/amiechenn/jquery-2.1.3.min.js"></script>
<title>井字过三关</title>
<style>
body{
	width:320px;
	margin:auto;
	position:relative;
	color:#FFF;
}
#contain{
	width:16rem;
	padding:1rem;
	margin:auto;
	background-color:#333;
	border:#FFF solid 2px;
	border-radius:10px;
	-moz-border-radius:10px;
	 -webkit-border-radius:10px;
	 -o-border-radius:10px;
}
.col0{
	float:left;
	line-height:5rem;
}
.col1{
	float:left;
	line-height:5rem;
}

.col2{
	float:left;
	line-height:5rem;
	
}
.block{
	border:#FFF solid 2px;
	width:5rem;
}
#dialog{
	position:relative;
	top:2rem;
	margin:auto;
}
#dialog p{
	display:block;
	margin:auto;
	text-align:center;
	padding:1rem;
}
#dialog button{
	font-size:1rem;
	color:#FFF;
	background-color:#F63;
	border:#F93 solid 2px;
	line-height:2rem;
	border-radius:10px;
	-moz-border-radius:10px;
	 -webkit-border-radius:10px;
	 -o-border-radius:10px;
	 position:relative;
	 top:-3rem;
}
#dialog p b{
	font-size:1.5rem;
	color:#F00;
}
#duangwin{
	display:block;
	position:relative;
	top:-3.5rem;
	
}
</style>
</head>

<body>
<div id=contain>
	<div class="col0">
		<div id="col0row0" class="block" onClick="reply_click(this.id)"></div>
		<div id="col0row1" class="block" onClick="reply_click(this.id)"></div>
		<div id="col0row2" class="block" onClick="reply_click(this.id)"></div>
	</div>
	<div class="col1">
		<div id="col1row0" class="block" onClick="reply_click(this.id)"></div>
		<div id="col1row1" class="block" onClick="reply_click(this.id)"></div>
		<div id="col1row2" class="block" onClick="reply_click(this.id)"></div>
	</div>
	<div class="col2">
		<div id="col2row0" class="block" onClick="reply_click(this.id)"></div>
		<div id="col2row1" class="block" onClick="reply_click(this.id)"></div>
		<div id="col2row2" class="block" onClick="reply_click(this.id)"></div>
	</div>		
	<div style="clear:both"></div>	
</div>
<div id="dialog">
	<p><b id="win" style="visibility:hidden">你打败了duang！</b></p>
	<p><b id="duangwin" style="visibility:hidden">duang win</b></p>
	<p ><button id="again">重新开始</button></p>
</div>
<div id="song" style="visibility:hidden"> </div>

</body>
<script>

var player=0;
var stepOfPlayer=0;
var arr = [[ 0, 0, 0],[ 0, 0, 0],[ 0, 0, 0]];

for(var i=0;i<3;i++){
	for(var j=0;j<3;j++){
		
	updateBoard(i,j);
	}
}

function selId(i ,j){
	 y=i;
	 x=j;
	return "col"+x+"row"+y ;
	
}

function getColRowByString(string_id){
	 var arr_id= string_id.split("");
	 var j=arr_id[3];
	 var i=arr_id[7]; 
	 var arr=[i,j];
	 return arr;
}

function updateBoard(i,j){
	if(arr[i][j]==0){
		document.getElementById(selId(i ,j)).innerHTML = "&nbsp;";
	}
	if(arr[i][j]==1){
		document.getElementById(selId(i ,j)).innerHTML ="<img src=\"images/player1.png\" width=\"81px\" height=\"80px\"/>";
	}
	if(arr[i][j]==2){
		document.getElementById(selId(i ,j)).innerHTML ="<img src=\"images/player2.jpg\" width=\"81px\" height=\"80px\"/>";
	}
}



function judge(arr){
		for(i=0;i<3;i++){
			if(arr[i][0]==arr[i][1] && arr[i][1]==arr[i][2] && arr[i][1]!=0){
				
				
				$(".block").attr("onClick","")
				return true;
			}
			if(arr[0][i]==arr[1][i] && arr[1][i]==arr[2][i] && arr[1][i]!=0){
				
				
				$(".block").attr("onClick","")
				return true;
			}
			
		}
		if(arr[0][0]==arr[1][1] && arr[1][1]==arr[2][2] && arr[1][1]!=0){
			
			$(".block").attr("onClick","")
			return true;
		}
		if(arr[0][2]==arr[1][1] && arr[1][1]==arr[2][0] && arr[1][1]!=0){
			
			$(".block").attr("onClick","")
			return true;
		}
		
	return false;
}
function GetRandomNum(Min,Max){   
	var Range = Max - Min;   
	var Rand = Math.random();   
	return(Min + Math.round(Rand * Range));   
} 
  
function reply_click(clicked_id){
	var x=getColRowByString(clicked_id);
	var i=x[0];
	var j=x[1];
	if(arr[i][j]==0){
		player++;
		stepOfPlayer++;
		if(player==1){
			
			arr[i][j]=1;
		}
		//if(player==2){
			//arr[i][j]=2;
			//player=0;
		//}
	}
	updateBoard(i,j);
	//judge(arr);
	if(judge(arr)==true ){
		$("#win").attr("style","visibility:visible");
		return 
	}
	
	// AI 下棋
	
	if(judge(arr)==false && player==1 && stepOfPlayer!=5){
		var i=GetRandomNum(0,2);
		var j=GetRandomNum(0,2);
		while(arr[i][j]!=0){
			
			i=GetRandomNum(0,2);
			 j=GetRandomNum(0,2);
		}
		
			arr[i][j]=2;
				player=0;
		
		updateBoard(i,j);
		
		//judge(arr);
		if(judge(arr)==true){
			$("#duangwin").attr("style","visibility:visible");
			document.getElementById("song").innerHTML = "<audio src=\"song.mp3\" controls=\"controls\" autoplay=\"autoplay\"></audio>"
			return
		}
		
	}
	
	
	// AI 动画
	
	// AI 赢判断
	
	
     return clicked_id;
}



$("#again").click(function(){
	$("#win").attr("style","visibility:hidden");
	$("#duangwin").attr("style","visibility:hidden");
	$(".block").attr("onClick","reply_click(this.id)")
	arr = [[ 0, 0, 0],
           [ 0, 0, 0],
           [ 0, 0, 0]];
	for(var i=0;i<3;i++){
		for(var j=0;j<3;j++){
			
		updateBoard(i,j);
		}
	}

	player=0;
	stepOfPlayer=0;

});


</script>
</html>
