<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, ,maximum-scale=1.0,user-scalable=no" />
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<title>摇一摇</title>

<style>
body
{
	background-image:url(image/1.jpg);
}



#number
{
	position:absolute;
	left:9rem;
	top:8rem;
	font-size:4rem;
	color:#FF5F11;
}

#button
{
	position:absolute;
	left:7rem;
	top:20rem;
	width:6rem;
	height:3rem;
	font-size:1rem;
	
	border:#FF8282 solid ;
	color:#FFF;
}
</style>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js"></script>
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>

</head>

<body>

<div id="number"  style="visibility:visible;"></div>
	
<button id=button onclick="playGame(),playBegin()"  style="background-color:#F44;">开&nbsp;&nbsp;始</button>
<div id="dialog" title="score"></div>  
	
</body>


<script>
var playing=false;
var SHAKE_THRESHOLD = 2000;
var last_update = 0;
var x = y = z = last_x = last_y = last_z = 0;
var media;
var score = 0;


		


function init() {
	last_update = new Date().getTime();
	media = document.getElementById("musicBox");
	if (window.DeviceMotionEvent) {
		window.addEventListener('devicemotion', deviceMotionHandler, false);
	} 
	else {
		
		alert('not support mobile event');
	}
}

function deviceMotionHandler(eventData) {
	
	var acceleration = eventData.accelerationIncludingGravity;
	
	var curTime = new Date().getTime();
	if ((curTime - last_update) > 100) {
		var diffTime = curTime - last_update;
		last_update = curTime;
		x = acceleration.x;
		y = acceleration.y;
		z = acceleration.z;
		var speed = Math.abs(x + y + z - last_x - last_y - last_z) / 
		diffTime * 10000;
		
		if (speed > SHAKE_THRESHOLD) {
			
			function addone(){
				
				score++;
				document.getElementById("number").innerHTML = score;
				
			}
			addone();
			

		}
		last_x = x;
		last_y = y;
		last_z = z;
	}

}

function playGame(){
	setTimeout (function (){window.removeEventListener('devicemotion', deviceMotionHandler, false),scoreDialog()},5000);
	score=0;
	document.getElementById("number").innerHTML = score;
	init() ;
}	



function buttonState(){
	if(playing==true){
		$("#button").attr("onclick","");
		$("#button").attr("style","background-color:#999;");
	}
	if(playing==false){
		$("#button").attr("onclick","playGame(),playBegin()");
		$("#button").attr("style","background-color:#F44;");	
	}
}
function playBegin(){
	playing=true;
	buttonState();
	//playing=1,playbegin,button over
};

function scoreDialog(){
	playing=false;
	$(function () {
		$("#dialog").dialog({
			modal:true,
			close:buttonState,
			buttons:{
				"再来一发":function(){
					$(this).dialog("close");
				}
			}
		});
	
	});
	document.getElementById("dialog").innerHTML = score;
}







</script>

<script>

</script>

</html>
