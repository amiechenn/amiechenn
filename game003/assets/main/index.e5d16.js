window.__require=function c(t,e,l){function r(o,s){if(!e[o]){if(!t[o]){var n=o.split("/");if(n=n[n.length-1],!t[n]){var a="function"==typeof __require&&__require;if(!s&&a)return a(n,!0);if(i)return i(n,!0);throw new Error("Cannot find module '"+o+"'")}o=n}var h=e[o]={exports:{}};t[o][0].call(h.exports,function(c){return r(t[o][1][c]||c)},h,h.exports,c,t,e,l)}return e[o].exports}for(var i="function"==typeof __require&&__require,o=0;o<l.length;o++)r(l[o]);return r}({game:[function(c,t){"use strict";cc._RF.push(t,"dbfedUGnuxAXpHvUgWQnd9S","game"),cc.Class({extends:cc.Component,properties:{blockBox:cc.Node,ctrlBlockArea:cc.Node,block1:cc.SpriteFrame,block2:cc.SpriteFrame,block3:cc.SpriteFrame,block4:cc.SpriteFrame,block5:cc.SpriteFrame,block6:cc.SpriteFrame,block7:cc.SpriteFrame,block8:cc.SpriteFrame,motionPrefal:cc.Prefab,boomPrefal:cc.Prefab,scoreLabel:cc.Label,gameOver:cc.Node,gameOverScore:cc.Label},test:function(){var c=[{x:-216.2788943714317,y:110.78104463070876,level:1,acr:2.668221724282403,selfArcHarf:.0823277750434939}];this.testB={x:240.4539643366011,y:-35.084056704043725,level:4};for(var t=0;t<c.length;t++){var e=c[t],l=e.level;aa=new cc.Node("Sprite");var r=aa.addComponent(cc.Sprite);r.sizeMode="CUSTOM",r.spriteFrame=this["block"+l],aa.parent=this.blockBox,aa.setPosition(cc.v2(e.x,e.y));var i=this.blockSize+(l-1)*this.blockSizeAdd;aa.setContentSize(cc.size(i,i)),aa.selfArcHarf=e.selfArcHarf,aa.arc=e.arc,aa.level=l}this.createBlock(!0,this.testB.level),this.arrToSort()},testClick:function(){this.ctrlBlcokGo(this.testB)},init:function(){this.gameOver.active=!1,this.ctrlBlockArea.destroyAllChildren(),this.blockBox.destroyAllChildren(),this.scoreLabel.string=0,this.colorArr=["",new cc.Color(0,133,255,255),new cc.Color(255,0,20,255),new cc.Color(143,13,216,255),new cc.Color(255,245,0,255),new cc.Color(246,126,7,255),new cc.Color(246,7,88,255),new cc.Color(0,255,5,255)],this.blockSize=40,this.blockSizeAdd=20,this.maxLevel=7,this.canCtrlBlcokLevel=4,this.pi=3.1415926,this.circleRadius=243,this.speedMillisecond=200,this.speedSecond=.2,this.speedMove=.2,this.speedScaleTo=.5,this.ctrlBlock=null,this.clickFlag=!1,this.blockArr=[],this.maxNumInCircle=parseInt(6.28/this.getBlcokArc(this.blockSize+(this.maxLevel-1)*this.blockSizeAdd/2)),this.isGameOver=!1,this.createBlock(!0,1),this.setTouch()},romoveMotion:function(){this.ctrlBlock.getChildByName("motion").destroy()},changeCtrlBlock:function(){if(this.ctrlBlock.level<=this.maxLevel){var c=new cc.Node("Sprite"),t=c.addComponent(cc.Sprite);t.sizeMode="CUSTOM",t.spriteFrame=this.ctrlBlock.getChildByName("ctrlBlock").getComponent(cc.Sprite).spriteFrame,c.parent=this.blockBox,c.setPosition(cc.v2(this.ctrlBlock.x,this.ctrlBlock.y)),c.setContentSize(cc.size(this.ctrlBlock.width,this.ctrlBlock.height)),c.level=this.ctrlBlock.level}this.ctrlBlock.destroy(),this.ctrlBlock=this.waitBlcok,this.arrToSort()},createBlock:function(c,t){var e=this,l=t||Math.ceil(Math.random()*this.canCtrlBlcokLevel);this.waitBlcok=new cc.Node("Node"),this.waitBlcok.parent=this.ctrlBlockArea;var r=new cc.Node("Sprite");r.parent=this.waitBlcok,r.name="ctrlBlock";var i=r.addComponent(cc.Sprite);i.sizeMode="CUSTOM",i.spriteFrame=this["block"+l],this.waitBlcok.setPosition(cc.v2(0,0)),this.waitBlcok.setScale(cc.v2(0,0));var o=this.blockSize+(l-1)*this.blockSizeAdd;this.waitBlcok.setContentSize(cc.size(o,o)),r.setContentSize(cc.size(o,o)),this.waitBlcok.selfArcHarf=this.getBlcokArc(o/2)/2,this.waitBlcok.level=l;var s=cc.instantiate(this.motionPrefal);s.parent=this.waitBlcok,s.zIndex=-1;var n=s.getComponent(cc.MotionStreak);n.fadeTime=this.speedSecond,n.stroke=o,n.color=this.colorArr[l];var a=cc.instantiate(this.boomPrefal);a.parent=this.waitBlcok,a.color=this.colorArr[l],console.log("waitBlcok",this.waitBlcok);var h=cc.scaleTo(this.speedScaleTo,1,1),f=cc.sequence(h,cc.callFunc(function(){c&&(e.ctrlBlock=e.waitBlcok,e.clickFlag=!0)}));this.waitBlcok.runAction(f)},setTouch:function(){this.node.on("touchend",function(c){if(this.clickFlag){var t=c.getLocation();t=this.node.convertToNodeSpaceAR(t),this.ctrlBlcokGo(t),this.createBlock(!1,this.testNum)}},this)},ctrlBlcokGo:function(c){this.clickFlag=!1;var t=this.getArcAndRadius(c.x,c.y),e=this.getPosition(t.arc,this.circleRadius);this.actionBy=cc.moveTo(this.speedSecond,cc.v2(e.x,e.y)),this.ctrlBlock.arc=t.arc,console.log("\u53d1\u5c04\u6c42\u7684\u4f4d\u7f6exy",{x:e.x,y:e.y,level:this.ctrlBlock.level}),this.checkBlack()},getBlcokArc:function(c){return 4*Math.asin(c/2/this.circleRadius)},getArcAndRadius:function(c,t){var e={};return e.r=Math.sqrt(c*c+t*t),e.arc=Math.atan(t/c),t>0&&c<0?e.arc=e.arc+this.pi:t<0&&c<0?e.arc=e.arc+this.pi:t<0&&c>0&&(e.arc=e.arc+2*this.pi),e},getPosition:function(c,t){var e={};return e.x=t*Math.cos(c),e.y=t*Math.sin(c),e},arrToSort:function(){var c=this.blockBox.children;if(c.length>0){for(var t=0;t<c.length;t++){var e=c[t];e.arc=this.getArcAndRadius(e.x,e.y).arc,e.selfArcHarf=this.getBlcokArc(e.width/2)/2}c=c.sort(function(c,t){return c.arc-t.arc})}this.blockArr=c,this.clickFlag=!0},checkBlack:function(){var c=this,t=0,e=0,l=null,r=null;if(0!=this.blockArr.length){for(var i=0;i<this.blockArr.length;i++){var o=this.blockArr[i];if(0!=o.x||0!=o.y){var s=this.checkBlackIsInside(o,this.ctrlBlock),n=this.ctrlBlock.selfArcHarf+o.selfArcHarf;if(s){"left"==this.isBlockLfetOrRight(o,this.ctrlBlock)?(n=o.arc-n,t=null,e=2*this.ctrlBlock.selfArcHarf,l=i):(n=o.arc+n,t=2*this.ctrlBlock.selfArcHarf,e=null,l=i==this.blockArr.length-1?0:i+1),this.ctrlBlock.arc=n;var a=this.getPosition(n,this.circleRadius);this.actionBy=cc.moveTo(this.speedSecond,cc.v2(a.x,a.y));var h=cc.sequence(this.actionBy,cc.callFunc(function(){c.romoveMotion()}));return this.ctrlBlock.runAction(h),void this.moveAllBlcok(t,e,l,r)}}}for(var f=0;f<this.blockArr.length;f++){var k=this.blockArr[f];0==k.x&&0==k.y||this.checkBlackIsOverlap(k,this.ctrlBlock)&&("left"==this.isBlockLfetOrRight(k,this.ctrlBlock)?(t=this.getOverlapArc(k,this.ctrlBlock),l=f):(e=this.getOverlapArc(this.ctrlBlock,k),r=f))}if(t||e){var B=cc.sequence(this.actionBy,cc.callFunc(function(){c.romoveMotion()}));this.ctrlBlock.runAction(B),this.moveAllBlcok(t,e,l,r)}else this.moveToNearestBlock()}else{var v=cc.sequence(this.actionBy,cc.callFunc(function(){c.romoveMotion(),c.changeCtrlBlock()}));this.ctrlBlock.runAction(v)}},checkBlackIsInside:function(c,t){if(!this.checkBlackIsOverlap(c,t))return!1;var e=2*this.pi,l=this.pi/2,r=c.arc+c.selfArcHarf,i=c.arc-c.selfArcHarf,o=t.arc+t.selfArcHarf,s=t.arc-t.selfArcHarf;return r>e&&(r-=e),r<0&&(r=e+r),i>e&&(i-=e),i<0&&(i=e+i),o>e&&(o-=e),o<0&&(o=e-o),s>e&&(s-=e),s<0&&(s=e+s),r<l&&i>e-l&&(i-=e,o>e-l&&(o-=e),s>e-l&&(s-=e)),o<l&&s>e-l&&(s-=e,r>e-l&&(r-=e),i>e-l&&(i-=e)),c.width>t.width?r>=o&&i<=s:o>=r&&s<=i},checkBlackIsOverlap:function(c,t){return this.getDelta(c,t).toFixed(6)<(c.selfArcHarf+t.selfArcHarf).toFixed(6)},checkBlockBySide:function(c,t){return!(this.getDelta(c,t).toFixed(6)>(c.selfArcHarf+t.selfArcHarf+1e-5).toFixed(6))},getOverlapArc:function(c,t){return t.selfArcHarf+t.arc-(c.arc-c.selfArcHarf)},reSort:function(c){var t,e=[];return e=this.blockArr.slice(c,this.blockArr.length),t=this.blockArr.slice(0,c),e.concat(t)},splitBlockArr:function(c){for(var t=0;t<c.length;t++){var e=c[t],l=c[t-1];if(0!=e.x||0!=e.y){var r=null,i=null;if(0==t?(r=this.checkBlockBySide(this.ctrlBlock,e),i=this.isBlockLfetOrRight(e,this.ctrlBlock),c.length>1&&this.ctrlBlock.arc-this.ctrlBlock.selfArcHarf<e.arc&&(i="left")):(r=this.checkBlockBySide(l,e),i=this.isBlockLfetOrRight(e,l)),!r||"right"==i||""==i)return{leftArr:c.slice(0,t),rightArr:c.slice(t,c.length).reverse()}}}return{leftArr:c.slice(0,c.length),rightArr:[]}},moveAllBlcok:function(c,t,e,l){var r,i,o=this;null==e&&(e=l+1),r=this.reSort(e);for(var s=[],n=0;n<r.length;n++){var a=r[n];s[n]={x:a.x,y:a.y,level:a.level,acr:a.arc,selfArcHarf:a.selfArcHarf}}console.log("copyArray",s),i=this.splitBlockArr(r),this.isGameOver=r.length>this.maxNumInCircle&&this.checkIsGameOver(i.leftArr,i.rightArr,c,t),console.log("this.isGameOver",this.isGameOver),this.moveAllBlcokToLeftOrRight("left",c,i.leftArr,function(){if(0==i.rightArr.length){if(o.isGameOver)return;o.moveAllOverCallFun(i.leftArr,i.rightArr)}}),this.moveAllBlcokToLeftOrRight("right",t,i.rightArr,function(){o.isGameOver||o.moveAllOverCallFun(i.leftArr,i.rightArr)})},moveAllBlcokToLeftOrRight:function(c,t,e,l){for(var r=0;r<e.length;r++){var i=e[r],o="left"==c?i.arc+t:i.arc-t;i.arc=o;var s=this.getPosition(o,this.circleRadius),n=cc.moveTo(this.speedMove,cc.v2(s.x,s.y));if(r==e.length-1){var a=cc.sequence(n,cc.callFunc(function(){l&&l()}));i.runAction(a)}else{var h=cc.sequence(n,cc.callFunc(function(){}));i.runAction(h)}}},moveAllOverCallFun:function(c,t){var e=this,l=c.length>0&&this.checkLevel(c[0]),r=t.length>0&&this.checkLevel(t[0]);if(l||r)return l&&r?(c[0].destroy(),c.splice(0,1),t[0].destroy(),t.splice(0,1),void this.ctrlBlockLevelUp("mid",function(){if(c.length>0){var l=e.getOverlapArc(c[0],e.ctrlBlock);e.moveAllBlcokToLeftOrRight("left",l,c,function(){0==t.length&&e.moveAllOverCallFun(c,t)})}if(t.length>0){var r=e.getOverlapArc(e.ctrlBlock,t[0]);e.moveAllBlcokToLeftOrRight("right",r,t,function(){e.moveAllOverCallFun(c,t)})}0==c.length&&0==t.length&&e.moveAllOverCallFun(c,t)})):l?(c[0].destroy(),c.splice(0,1),void this.ctrlBlockLevelUp("right",function(){if(c.length>0){var l;l=c[0].arc>e.ctrlBlock.arc?c[0].arc-e.ctrlBlock.arc-c[0].selfArcHarf-e.ctrlBlock.selfArcHarf:c[0].arc+(2*e.pi-e.ctrlBlock.arc)-c[0].selfArcHarf-e.ctrlBlock.selfArcHarf,e.moveAllBlcokToLeftOrRight("right",l,c,function(){e.ctrlBlock.level>e.maxLevel&&(e.oneBlcokChangeCtrlBlock(t[0]),t[0].destroy(),t.splice(0,1)),e.moveAllOverCallFun(c,t)})}else e.moveAllOverCallFun(c,t)})):r?(t[0].destroy(),t.splice(0,1),void this.ctrlBlockLevelUp("left",function(){if(t.length>0){var l;l=e.ctrlBlock.arc>t[0].arc?e.ctrlBlock.arc-t[0].arc-t[0].selfArcHarf-e.ctrlBlock.selfArcHarf:e.ctrlBlock.arc+(2*e.pi-t[0].arc)-t[0].selfArcHarf-e.ctrlBlock.selfArcHarf,e.moveAllBlcokToLeftOrRight("left",l,t,function(){e.ctrlBlock.level>e.maxLevel&&(e.oneBlcokChangeCtrlBlock(c[0]),c[0].destroy(),c.splice(0,1)),e.moveAllOverCallFun(c,t)})}else e.moveAllOverCallFun(c,t)})):void 0;setTimeout(function(){e.changeCtrlBlock()},this.speedMillisecond)},isBlockLfetOrRight:function(c,t){if(void 0===t||void 0===c)return"";var e=t.arc,l=e>this.pi?e-this.pi:e+this.pi;return e<=this.pi?c.arc>e&&c.arc<l?"left":"right":c.arc<e&&c.arc>l?"right":"left"},moveToNearestBlock:function(){var c=this.blockArr,t=[],e=this.ctrlBlock.arc;if(1!=c.length)if(e<c[0].arc)(t=this.reSort(0))[0].arc-e<e+(2*this.pi-t[t.length-1].arc)?this.moveToBlockByCircle(t,"right",0):this.moveToBlockByCircle(t,"left",t.length-1);else if(e>c[c.length-1].arc)(t=this.reSort(0))[0].arc+(2*this.pi-e)<e-t[t.length-1].arc?this.moveToBlockByCircle(t,"right",0):this.moveToBlockByCircle(t,"left",t.length-1);else for(var l=0;l<c.length;l++)e>c[l].arc&&e<c[l+1].arc&&((t=this.reSort(l+1))[0].arc-e<e-t[t.length-1].arc?this.moveToBlockByCircle(t,"right",0):this.moveToBlockByCircle(t,"left",t.length-1));else"left"==this.isBlockLfetOrRight(this.ctrlBlock,c[0])?this.moveToBlockByCircle(c,"left",0):this.moveToBlockByCircle(c,"right",0)},moveToBlockByCircle:function(c,t,e){var l=this,r=2*this.pi,i=c[e],o=this.ctrlBlock.selfArcHarf+i.selfArcHarf;(o="right"==t?i.arc-o:i.arc+o)<0&&(o=r+o),o>r&&(o-=r);var s=this.ctrlBlock.arc;this.ctrlBlock.arc=o;var n=Math.abs(o-s);"right"==t?s>this.pi&&o<this.pi&&(n=Math.abs(r-s+o)):o>this.pi&&s<this.pi&&(n=Math.abs(r-o+s));var a=cc.sequence(this.actionBy,cc.callFunc(function(){l.romoveMotion();var r=[],i=cc.callFunc(function(){l.moveToBlockByCircleCallFun(c,e)});if(n>.4)for(var a=parseInt(n/.4),h=0;h<a+1;h++)if(h==a){var f=l.getPosition(o,l.circleRadius),k=cc.moveTo(.1,cc.v2(f.x,f.y));r.push(k),r.push(i)}else{var B="right"==t?s+.4*(h+1):s-.4*(h+1),v=l.getPosition(B,l.circleRadius),u=cc.moveTo(.1,cc.v2(v.x,v.y));r.push(u)}else{var g=l.getPosition(o,l.circleRadius),m=cc.moveTo(l.speedMove,cc.v2(g.x,g.y));r.push(m),r.push(i)}var A=cc.sequence(r);l.ctrlBlock.runAction(A)}));this.ctrlBlock.runAction(a)},moveToBlockByCircleCallFun:function(c,t){var e=this,l=c[t];if(this.checkLevel(l))return 0==t&&1==c.length?(c[0].destroy(),void this.ctrlBlockLevelUp("mid",function(){e.changeCtrlBlock()})):0==t?(c[t].destroy(),c.splice(t,1),void this.ctrlBlockLevelUp("right",function(){var t;c.length>0?(t=c[0].arc-e.ctrlBlock.arc-c[0].selfArcHarf-e.ctrlBlock.selfArcHarf,e.moveAllBlcokToLeftOrRight("right",t,c,function(){e.moveToBlockByCircleCallFun(c,0)})):e.changeCtrlBlock()})):(c[t].destroy(),c.splice(t,1),void this.ctrlBlockLevelUp("left",function(){var l;c.length>0?(l=e.ctrlBlock.arc-c[t-1].arc-c[t-1].selfArcHarf-e.ctrlBlock.selfArcHarf,e.moveAllBlcokToLeftOrRight("left",l,c,function(){e.moveToBlockByCircleCallFun(c,t-1)})):e.changeCtrlBlock()}));this.changeCtrlBlock()},checkLevel:function(c){return c.level==this.ctrlBlock.level},ctrlBlockLevelUp:function(c,t){var e=this;this.ctrlBlock.getChildByName("boom").getComponent(cc.Animation).play(),this.scoreLabel.string=parseInt(this.scoreLabel.string)+parseInt(this.ctrlBlock.level);var l=this.blockSize+this.ctrlBlock.level*this.blockSizeAdd,r=this.getBlcokArc(l/2)/2,i=this.ctrlBlock.arc;"right"==c?i=this.ctrlBlock.arc-this.ctrlBlock.selfArcHarf+r:"left"==c&&(i=this.ctrlBlock.arc+this.ctrlBlock.selfArcHarf-r);var o=this.getPosition(i,this.circleRadius);this.ctrlBlock.getChildByName("ctrlBlock").runAction(cc.scaleTo(.2,0,0)),setTimeout(function(){e.ctrlBlock.level=e.ctrlBlock.level+1,e.ctrlBlock.setPosition(cc.v2(o.x,o.y)),e.ctrlBlock.level<e.maxLevel+1?(e.ctrlBlock.setContentSize(cc.size(l,l)),e.ctrlBlock.getChildByName("ctrlBlock").setContentSize(cc.size(l,l)),e.ctrlBlock.getChildByName("ctrlBlock").getComponent(cc.Sprite).spriteFrame=e["block"+e.ctrlBlock.level],e.ctrlBlock.getChildByName("ctrlBlock").runAction(cc.scaleTo(.2,1,1)),e.ctrlBlock.getChildByName("boom").color=e.colorArr[e.ctrlBlock.level],e.ctrlBlock.selfArcHarf=r,e.ctrlBlock.arc=i):(e.ctrlBlock.setContentSize(cc.size(0,0)),e.ctrlBlock.getChildByName("ctrlBlock").setContentSize(cc.size(0,0)),"right"==c?i-=r:"left"==c&&(i+=r),e.ctrlBlock.arc=i,e.ctrlBlock.selfArcHarf=0),t&&t()},200)},oneBlcokChangeCtrlBlock:function(c){this.ctrlBlock.level=c.level,this.ctrlBlock.setPosition(cc.v2(c.x,c.y)),this.ctrlBlock.setContentSize(cc.size(c.width,c.height)),this.ctrlBlock.getChildByName("ctrlBlock").setContentSize(cc.size(c.width,c.height)),this.ctrlBlock.getChildByName("ctrlBlock").getComponent(cc.Sprite).spriteFrame=c.getComponent(cc.Sprite).spriteFrame,this.ctrlBlock.getChildByName("boom").color=this.colorArr[this.ctrlBlock.level],this.ctrlBlock.selfArcHarf=c.selfArcHarf,this.ctrlBlock.arc=c.arc},getDelta:function(c,t){var e=c.arc-t.arc;return Math.abs(e)>this.pi&&(e=t.arc>this.pi?2*this.pi-t.arc+c.arc:2*this.pi-c.arc+t.arc),Math.abs(e)},gameOverAction:function(c,t,e,l){var r=this,i=cc.repeat(cc.sequence(cc.scaleTo(.5,.7,.7),cc.scaleTo(.5,1,1)),3),o=cc.repeat(cc.sequence(cc.scaleTo(.5,.7,.7),cc.scaleTo(.5,1,1)),2);c.runAction(i),t.runAction(o),setTimeout(function(){if(e.length>0&&l.length>0){e=e.reverse(),l=l.reverse();for(var c=function(c){c==e.length?e.length>=l.length&&setTimeout(function(){r.ctrlBlock.getChildByName("boom").getComponent(cc.Animation).play(),r.ctrlBlock.destroy(),r.gameOverScene()},150*c):setTimeout(function(){r.boomArr(e[c])},150*c)},t=0;t<e.length+1;t++)c(t);for(var i=function(c){c==l.length?l.length>e.length&&setTimeout(function(){r.ctrlBlock.getChildByName("boom").getComponent(cc.Animation).play(),r.ctrlBlock.destroy(),r.gameOverScene()},150*c):setTimeout(function(){r.boomArr(l[c])},150*c)},o=0;o<l.length+1;o++)i(o)}0!=e.length&&0!=l.length||function(){var c=e.length>0?e:l;c=c.reverse();for(var t=function(t){t==c.length?setTimeout(function(){r.ctrlBlock.getChildByName("boom").getComponent(cc.Animation).play(),r.ctrlBlock.destroy(),r.gameOverScene()},150*t):setTimeout(function(){r.boomArr(c[t])},150*t)},i=0;i<c.length+1;i++)t(i)}()},2e3)},boomArr:function(c){var t=cc.instantiate(this.boomPrefal);t.color=this.colorArr[c.level],t.setPosition(cc.v2(c.x,c.y)),t.parent=this.blockBox,t.getComponent(cc.Animation).play(),c.destroy()},checkIsGameOver:function(c,t,e,l){if(c.length>0&&t.length>0){var r=c[c.length-1],i=t[t.length-1];return this.getDelta(r,i)-r.selfArcHarf-i.selfArcHarf<=2*this.ctrlBlock.selfArcHarf&&(this.gameOverAction(r,i,c,t),!0)}if(0==c.length){var o=t[t.length-1],s=this.ctrlBlock;return this.getDelta(o,s)-o.selfArcHarf-s.selfArcHarf<=l&&(this.gameOverAction(o,s,c,t),!0)}if(0==t.length){var n=c[c.length-1],a=this.ctrlBlock;return this.getDelta(n,a)-n.selfArcHarf-a.selfArcHarf<=e&&(this.gameOverAction(n,a,c,t),!0)}},gameOverScene:function(){this.gameOverScore.string=this.scoreLabel.string,this.gameOver.active=!0},clickStart:function(){this.init()},onLoad:function(){this.init()},start:function(){},update:function(){}}),cc._RF.pop()},{}]},{},["game"]);